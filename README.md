# ROS-four_ws_navigation-src

## установка пакетов

<p align="center">
<img src="imgs/skelet.JPG">
</p>

```bash
cd
```

```bash
mkdir ~/four_ws_navigation
```

```bash
cd ~/four_ws_navigation
```

```bash
git clone https://github.com/5met4nka/ROS-four_ws_navigation-src.git
```

```bash
mv ROS-four_ws_navigation-src src
```

```bash
cd src
```

```bash
cp -r four_ws_stage ~/.gazebo/models
```

```bash
rm -r four_ws_stage
```

```bash
cd ..
```

```bash
catkin_make
```

```bash
cd
```

в случае использование zsh

```bash
echo "source ~/four_ws_navigation/devel/setup.zsh" >> ~/.zshrc
```

или в случает bash

```bash
echo "source ~/four_ws_navigation/devel/setup.bash" >> ~/.bashrc
```

* замечание: ROS может видеть только один ws, поэтому комментим настройку запуска других ws при помощи символа "#"

## запуск навигации

```bash
roslaunch robot_launch launch_navigation_simulation.launch
```

```bash
roslaunch navigation_params navigation.launch
```

## запуск gmapping

```bash
roslaunch robot_launch launch_simulation_for_map_creation.launch
```

```bash
roslaunch gmapping rviz_slam_gmapping_view.launch
```
сохранение карты в файл

```bash
cd ~/four_ws_navigation/src/navigation_params/map
```

```bash
rosrun map_server map_saver -f four_ws_map
```

## параметры AMCL

официальная документация http://wiki.ros.org/amcl

### общие параметры фильтра

`min_particles (int, default: 100)` - минимально допустимое количество частиц

`max_particles (int, default: 5000)` - максимально допустимое количество частиц

`kld_err (double, default: 0.01)` - параметр "kld_err" относится к максимальному порогу ошибки, используемому в процессе выборки KLD. Процесс отбора проб KLD используется для адаптации количества частиц, используемых в алгоритме локализации по методу Монте-Карло, на основе распределения частиц. Параметр "kld_err" устанавливает пороговое значение для максимально допустимой ошибки в распределении частиц. Если ошибка превышает этот порог, количество частиц будет увеличено для повышения точности локализации. И наоборот, если ошибка ниже этого порога и количество частиц превышает порог "kld_z", количество частиц будет уменьшено для повышения эффективности вычислений. Короче говоря, параметр kld_err используется для контроля баланса между количеством частиц и точностью локализации.

kld_z (double, default: 0.99) -  относится к "z" (вертикальному) компоненту процесса "Выборки KLD". Выборка KLD - это метод, используемый для адаптации количества частиц, используемых в алгоритме локализации Монте-Карло, на основе распределения частиц. Компонент "z" этого процесса относится к вертикальному измерению окружающей среды робота, а параметр "kld_z" устанавливает порог для максимально допустимого количества частиц в измерении "z", выше которого количество частиц будет уменьшено. Цель состоит в том, чтобы поддерживать достаточное количество частиц, избегая при этом их слишком большого количества, что может замедлить процесс локализации.

update_min_d (double, default: 0.2 meters) - поступательное движение, необходимое перед выполнением обновления фильтра

update_min_a (double, default: π/6.0 radians) - вращательное движение, необходимое перед выполнением обновления фильтра

resample_interval (int, default: 2) - количество обновлений фильтра, необходимых перед повторной выборкой

transform_tolerance (double, default: 0.1 seconds) - определяет максимально допустимую разницу в секундах между временем записи преобразования и временем его использования. в AMCL положение и ориентация робота оцениваются на основе данных датчиков и карты окружающей среды. предполагаемое положение и ориентация робота представлены преобразованием, которое представляет собой математическое представление положения и ориентации робота во фрейме карты. параметр transform_tolerance используется для указания того, как долго алгоритм AMCL будет продолжать использовать преобразование, прежде чем оно будет признано слишком старым и должно быть отброшено. например, если для параметра transform_tolerance установлено значение 0,1 секунды, алгоритм AMCL будет использовать только преобразования, которые были записаны в течение последних 0,1 секунды. Если преобразование старше 0,1 секунды, оно будет отброшено, и алгоритм AMCL продолжит использовать последнее допустимое преобразование. это может помочь предотвратить использование алгоритмом устаревшей информации, что может привести к плохим результатам локализации. важно отметить, что для этого параметра следует установить значение, подходящее для конкретного приложения и конфигурации датчика, поскольку слишком низкое значение может привести к слишком частому удалению достоверной информации, а слишком высокое значение может привести к использованию устаревшей информации

recovery_alpha_slow (double, default: 0.0 (disabled)) - экспоненциальная скорость затухания для фильтра медленного среднего веса, используемого при принятии решения о том, когда восстанавливаться, добавляя случайные позы. Хорошим значением может быть 0,001

recovery_alpha_fast (double, default: 0.0 (disabled)) - экспоненциальная скорость затухания для фильтра быстрого среднего веса, используемого при принятии решения о том, когда восстанавливаться, добавляя случайные позы. Хорошим значением может быть 0.1

initial_pose_x (double, default: 0.0 meters) - начальное значение позы (x), используемое для инициализации фильтра с распределением по Гауссу

initial_pose_y (double, default: 0.0 meters) - начальное значение позы (y), используемое для инициализации фильтра с распределением по Гауссу

initial_pose_a (double, default: 0.0 radians) - начальное значение положения (рыскание), используемое для инициализации фильтра с распределением по Гауссу

initial_cov_xx (double, default: 0.5*0.5 meters) - начальная ковариация позы (x*x), используемая для инициализации фильтра с распределением по Гауссу

initial_cov_yy (double, default: 0.5*0.5 meters) - начальная ковариация позы (y*y), используемая для инициализации фильтра с распределением по Гауссу

initial_cov_aa (double, default: (π/12)*(π/12) radian) - начальная ковариация позы (рыскание*рыскание), используемая для инициализации фильтра с распределением по Гауссу

gui_publish_rate (double, default: -1.0 Hz) - максимальная частота (Гц), с которой сканы и пути публикуются для визуализации, -1.0 для отключения

save_pose_rate (double, default: 0.5 Hz) - максимальная частота (Гц), с которой последняя оцененная позиция и ковариация сохраняются на сервере параметров в переменных ~initial_pose_* и ~initial_cov_*. эта сохраненная позиция будет использоваться при последующих запусках для инициализации фильтра. -1.0 для отключения.

use_map_topic (bool, default: false) - если установлено значение true, AMCL подпишется на раздел карты, а не будет выполнять вызов службы для получения своей карты

first_map_only (bool, default: false) - если установлено значение true, AMCL будет использовать только первую карту, на которую он подписался, вместо того, чтобы обновлять ее каждый раз при получении новой

selective_resampling (bool, default: false) - определяет, должен ли алгоритм AMCL использовать выборочную повторную выборку или нет. повторная выборка - это процесс, который используется в фильтре частиц, который является основным компонентом алгоритма AMCL. фильтр частиц использует набор частиц для представления возможных местоположений робота на карте. повторная выборка используется для обновления набора частиц на основе данных датчика с целью обеспечения того, чтобы частицы, соответствующие более вероятным позициям робота, имели более высокую вероятность быть выбранными. выборочная повторная выборка - это метод оптимизации, который повышает эффективность процесса повторной выборки за счет повторной выборки только тех частиц, которые вряд ли соответствуют истинному положению робота. путем повторной выборки только подмножества частиц выборочная повторная выборка может уменьшить количество частиц, которые необходимо повторно выбрать, что может повысить производительность алгоритма AMCL. если параметру selective_resampling присвоено значение true, алгоритм AMCL будет использовать выборочную повторную выборку. если для него установлено значение false, алгоритм AMCL не будет использовать выборочную повторную выборку. важно отметить, что использование выборочной повторной выборки может повысить производительность алгоритма AMCL, но это также увеличивает время вычислений. поэтому важно учитывать компромисс между временем вычисления и точностью при установке параметра selective_resampling.

### параметры лазерной модели

laser_min_range (double, default: -1.0) - минимальный диапазон сканирования, который следует учитывать; -1.0 приведет к использованию заявленной минимальной дальности действия лазера

laser_max_range (double, default: -1.0) - максимальный диапазон сканирования, который следует учитывать; -1.0 приведет к использованиюзаявленной максимальной дальности действия лазера

laser_max_beams (int, default: 30) - сколько равномерно расположенных лучей в каждом сканировании следует использовать при обновлении фильтра

laser_z_hit (double, default: 0.95) - этот параметр представляет ожидаемое измерение попадания (т.е. когда лазерный луч успешно обнаруживает препятствие). более высокое значение этого параметра увеличит вероятность попадания частицы, когда данные лазерного сканирования совпадут с ожидаемым измерением попадания

laser_z_short (double, default: 0.1) - этот параметр представляет ожидаемое измерение для короткого считывания (т.е. когда лазерный луч обнаруживает препятствие до того, как он достигнет максимальной дальности). более высокое значение этого параметра увеличит вероятность обнаружения частицы, когда данные лазерного сканирования совпадут с ожидаемым измерением для короткого считывания

laser_z_max (double, default: 0.05) - этот параметр представляет максимальную дальность действия лазерного датчика. более высокое значение этого параметра уменьшит вероятность обнаружения частицы, когда данные лазерного сканирования превысят этот диапазон

laser_z_rand (double, default: 0.05) - этот параметр представляет вероятность случайного измерения (т.е. когда лазерный луч не обнаруживает препятствие).более высокое значение этого параметра увеличит вероятность обнаружения частицы, когда данные лазерного сканирования совпадут с ожидаемым измерением для случайного считывания

laser_sigma_hit (double, default: 0.2 meters) - этот параметр представляет стандартное отклонение распределения Гаусса, используемого для моделирования шума при измерениях попадания. более высокое значение этого параметра увеличит диапазон возможных измерений, которые будут считаться попаданием

laser_lambda_short (double, default: 0.1) - этот параметр представляет скорость затухания экспоненциального распределения, используемого для моделирования коротких показаний. более высокое значение этого параметра увеличит вероятность коротких показаний

laser_likelihood_max_dist (double, default: 2.0 meters) - этот параметр представляет максимальное расстояние, на котором модель лазерного датчика будет использоваться для вычисления вероятности обнаружения частицы. более высокое значение этого параметра увеличит диапазон, в котором будет использоваться модель датчика

laser_model_type (string, default: "likelihood_field") - относится к типу модели датчика, используемой для лазерного дальномера. модель датчика - это математическое представление характеристик датчика и того, как он взаимодействует с окружающей средой. пакет amcl поддерживает несколько различных моделей лазерных датчиков, а параметр "laser_model_type" позволяет вам выбрать, какую из них использовать. варианты таковы:

* "likelihood_field": эта модель использует поле правдоподобия для представления вероятности нахождения частицы в определенном месте на основе лазерных измерений

* "beam": в этой модели используется подход, основанный на луче, при котором каждый луч обрабатывается независимо

* "likelihood_field_prob": эта модель похожа на модель "likelihood_field", но в ней используется вероятностное представление вероятности

* "beam_model_prob": эта модель похожа на модель "beam", но в ней используется вероятностное представление вероятности

Выбор модели датчика будет зависеть от характеристик лазерного дальномера, окружающей среды и конкретных требований приложения

### параметры модели одометрии

odom_model_type (string, default: "diff") - относится к типу модели движения, используемой для одометрии. модель движения - это математическое представление того, как движется робот, и как на это движение влияют шум и другие факторы. пакет amcl поддерживает несколько различных моделей движения odometry, а параметр "odom_model_type" позволяет вам выбрать, какую из них использовать. варианты таковы:

• "diff": эта модель предназначена для роботов с дифференциальным приводом. Он предполагает, что движение робота состоит из прямой и угловой скоростей, и использует эти скорости для оценки положения и ориентации робота

• "omni": эта модель предназначена для всенаправленных роботов. Он использует поступательную и угловую скорости робота, а также его боковые скорости для оценки положения и ориентации робота

• "diff-corrected": Эта модель является расширением модели "diff" и использует одометрию колес и IMU для уменьшения дрейфа в одометрии.
Выбор модели движения будет зависеть от характеристик робота, окружающей среды и конкретных требований приложения

odom_alpha1 (double, default: 0.2) - этот параметр определяет количество шума, которое добавляется к скорости вращения робота

odom_alpha2 (double, default: 0.2) - этот параметр определяет количество шума, которое добавляется к скорости вращения робота

odom_alpha3 (double, default: 0.2) - этот параметр определяет количество шума, которое добавляется к поступательному перемещению робота

odom_alpha4 (double, default: 0.2) - этот параметр управляет уровнем шума, который добавляется к вращательному перемещению робота

odom_alpha5 (double, default: 0.2) - этот параметр определяет количество шума, которое добавляется к поступательному ускорению робота

odom_frame_id (string, default: "odom") - какой фрейм использовать для одометрии

base_frame_id (string, default: "base_link") - какой фрейм использовать для основания робота

global_frame_id (string, default: "map") - название системы координат, опубликованной системой локализации

tf_broadcast (bool, default: true) - относится к действию публикации предполагаемого положения и ориентации робота (pose) в виде сообщения "transform" в библиотеке преобразования ROS (tf). библиотека tf отвечает за поддержание связей между различными кадрами координат в системе, и она использует опубликованные преобразования для обновления положений различных кадров. параметр "tf_broadcast" - это логическое значение, которое определяет, будет ли узел amcl публиковать оценочную позу робота в библиотеке tf или нет. если установлено значение true, узел amcl опубликует оценочную позу, позволяя другим узлам использовать ее для обновления своих собственных кадров и выполнения других задач, таких как визуализация положения робота на карте. если установлено значение false, узел amcl не будет публиковать расчетную позу, и другие узлы не смогут получить к ней доступ. по умолчанию для параметра tf_broadcast установлено значение true, но можно установить для него значение false, если вы не хотите, чтобы amcl публиковал позу и использовал данные из других источников.
